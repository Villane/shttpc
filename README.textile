h2. Simple HTTP Client

Wraps Apache HttpClient 4.0 to provide an easy to use Scala API. Java users have some benefits as well.

Copyright (c) 2009, Erkki Lindpere
All rights reserved.

This software is distributed under the MIT license. See the file License.txt for the full text.

The project name *shttpc* is pronounced like ShittyPC.

A "Maven repository":http://villane.org/mavenrepo/org/villane/shttpc/ at villane.org contains both sources and binaries. 

h3. Usage examples (Scala)

h4. GET with params Map, comprehensions with NekoHTML parsed to Scala's XML Nodes

<pre><code>
import org.villane.shttpc._
import org.villane.shttpc.Preamble._

object MetacriticTest {
  val http = new Http

  case class Result(name: String, url: String, score: Int)
  
  def feelingLucky(query: String) = {
    val html = http.get("http://www.metacritic.com/search/process" ? Map(
      "sort" -> "relevance",
      "termtype" -> "all",
      "ts" -> query,
      "ty" -> "0"
    )).asHtml

    val res = for {
      div <- html \ "BODY" \ "DIV"
      if (div \ "@id" == "pagecontainer")
      col <- div \ "DIV" \ "TABLE" \ "TBODY" \ "TR" \ "TD"
      if (col \ "@id" == "rightcolumn")
      p <- col \ "P"
      if (p.text.startsWith("1."))
    } yield p

    Result(res \ "A" text, res \ "A" \ "@href" text, (res \ "SPAN" text).toInt)
  }

  def main(sgra: Array[String]) = {
    println(feelingLucky("Brutal Legend").score)
  }
}
</code></pre>

h4. Alternate comprehension with SHTTPC's XPath support

Note that XPath support is very limited, basically only expressions like the one below are supported.
<pre><code>
    val res = for {
      p <- html / "BODY/DIV[@id='pagecontainer']/DIV/TABLE/TBODY/TR/TD[@id='rightcolumn']/P"
      if (p.text.startsWith("1."))
    } yield p
</code></pre>

h3. Usage Examples (Java)

Similar Example to the above, but in Java.

<pre><code>
package tests;

import java.io.IOException;
import java.net.URLEncoder;

import javax.xml.parsers.ParserConfigurationException;
import javax.xml.xpath.XPath;
import javax.xml.xpath.XPathConstants;
import javax.xml.xpath.XPathExpressionException;
import javax.xml.xpath.XPathFactory;

import org.apache.http.client.ClientProtocolException;
import org.villane.shttpc.Http;
import org.villane.shttpc.SimpleHttpResponse;
import org.w3c.dom.Document;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;
import org.xml.sax.SAXException;

public class MetacriticTestJava {

	public static void main(String[] args) throws ClientProtocolException, IOException,
			ParserConfigurationException, SAXException, XPathExpressionException {
		Http http = new Http();
		String query = "Brutal Legend";
		SimpleHttpResponse response = http.get(
			"http://www.metacritic.com/search/process?sort=relevance&termtype=all&ts="
			 + URLEncoder.encode(query, "UTF-8")
			 + "&ty=0"
		);
		Document html = response.asDomHtml();
		XPathFactory factory = XPathFactory.newInstance();
		XPath xPath = factory.newXPath();
		NodeList nl = (NodeList) xPath.evaluate(
			"/HTML/BODY/DIV[@id='pagecontainer']/DIV/TABLE/TBODY/TR/TD[@id='rightcolumn']/P",
			html,
			XPathConstants.NODESET
		);
		for (int i = 0; i < nl.getLength(); i++) {
			Node node = nl.item(i);
			if (node.getTextContent().startsWith("1.")) {
				System.out.println(node.getTextContent());
			}
		}
	}
}
</code></pre>